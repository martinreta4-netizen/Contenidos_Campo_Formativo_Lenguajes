<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ODA Lenguajes ‚Äì Contenido 10: Cartas, Email y Mensajer√≠a (Fase 5)</title>

  <style>
    :root{
      --vino:#7a0f1f;
      --rojo:#b91c1c;
      --rojo-2:#ef4444;
      --dorado:#d7b56d;
      --naranja:#f97316;

      --bg1:#fff7ed;
      --bg2:#fef2f2;

      --text:#111827;
      --muted:#6b7280;
      --card:#ffffff;
      --border:#e5e7eb;

      --ok:#16a34a;
      --bad:#b91c1c;

      --shadow:0 18px 45px rgba(127,29,29,.22);
      --shadow2:0 10px 22px rgba(185,28,28,.20);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
      color:var(--text);
      background:linear-gradient(180deg,var(--bg1) 0,var(--bg2) 45%,#f9fafb 100%);
      overflow:hidden;
    }

    body::before{
      content:"";
      position:fixed;
      inset:10% 16%;
      background:url("escudo_escuela.png") center/contain no-repeat;
      opacity:.03;
      pointer-events:none;
      z-index:0;
    }

    .app{
      position:relative;
      z-index:1;
      height:100%;
      display:flex;
      flex-direction:column;
    }

    .topbar{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      gap:12px;
      padding:10px 12px;
      background:linear-gradient(90deg, #5b0b22, #b91c1c, #f97316);
      color:#fff;
      box-shadow:0 10px 26px rgba(127,29,29,.35);
    }
    .topbar .sep{
      height:38px;
      width:auto;
      background:#fff;
      padding:4px 8px;
      border-radius:10px;
      box-shadow:0 8px 18px rgba(0,0,0,.25);
      flex:0 0 auto;
    }
    .topbar .title{
      min-width:0;
      flex:1 1 auto;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .topbar h1{
      margin:0;
      font-size:1.05rem;
      line-height:1.2;
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size:.78rem;
      padding:3px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.16);
      border:1px solid rgba(255,255,255,.25);
      width:max-content;
    }
    .badge .dot{
      width:8px;height:8px;border-radius:50%;
      background:#34d399;
      box-shadow:0 0 0 5px rgba(52,211,153,.18);
    }
    .topbar .right{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .avatarChip{
      display:flex; align-items:center; gap:8px;
      padding:5px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.22);
    }
    .avatarChip img{
      width:34px;height:34px;border-radius:999px;
      background:#fff;
      padding:2px;
      object-fit:contain;
    }
    .avatarChip .txt{
      font-size:.78rem;
      line-height:1.1;
      white-space:nowrap;
    }
    .avatarChip strong{display:block;font-size:.8rem}

    .main{
      flex:1 1 auto;
      min-height:0;
      display:grid;
      grid-template-columns:320px minmax(0,1fr);
      gap:12px;
      padding:12px;
      overflow:hidden;
    }
    @media(max-width:980px){
      body{overflow:auto;}
      .main{grid-template-columns:1fr; overflow:visible;}
    }

    .panel{
      background:rgba(255,255,255,.92);
      border:1px solid var(--border);
      border-radius:22px;
      box-shadow:var(--shadow2);
      overflow:hidden;
      min-height:0;
      display:flex;
      flex-direction:column;
    }
    .panelHeader{
      padding:10px 12px;
      border-bottom:1px solid #fee2e2;
      background:linear-gradient(180deg,#fff, #fff5f5);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .panelHeader h2{
      margin:0;
      font-size:.95rem;
      color:#7f1d1d;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .panelBody{
      padding:10px 12px;
      overflow:auto;
      min-height:0;
    }

    .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    label.small{font-size:.8rem; color:#374151; font-weight:600}
    input.txt{
      width:100%;
      border-radius:999px;
      border:1px solid #fecaca;
      padding:7px 10px;
      font-size:.88rem;
      outline:none;
      background:#fff;
    }
    input.txt:focus{
      border-color:#fca5a5;
      box-shadow:0 0 0 3px rgba(239,68,68,.15);
    }

    select{
      border-radius:999px;
      border:1px solid #fecaca;
      background:#fff;
      padding:6px 10px;
      font-size:.86rem;
      outline:none;
    }
    select:focus{
      border-color:#fca5a5;
      box-shadow:0 0 0 3px rgba(239,68,68,.12);
    }

    .btn{
      border:none;
      cursor:pointer;
      border-radius:999px;
      padding:8px 12px;
      font-weight:700;
      font-size:.84rem;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
      user-select:none;
    }
    .btn:active{transform:translateY(1px)}
    .btnPrimary{
      color:#fff;
      background:linear-gradient(135deg,var(--rojo), var(--naranja));
      box-shadow:0 12px 24px rgba(185,28,28,.30);
    }
    .btnPrimary:hover{filter:brightness(1.03)}
    .btnGhost{
      background:#fff;
      border:1px solid #fecaca;
      color:#7f1d1d;
    }
    .btnSoft{
      background:#f3f4f6;
      color:#111827;
    }
    .btnMini{padding:6px 10px; font-size:.8rem}

    .steps{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .stepBtn{
      width:100%;
      text-align:left;
      border-radius:16px;
      border:1px solid #fee2e2;
      background:#fff;
      padding:10px 10px;
      cursor:pointer;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      transition:transform .12s ease, box-shadow .12s ease, border .12s ease;
    }
    .stepBtn:hover{
      transform:translateY(-1px);
      box-shadow:0 12px 22px rgba(127,29,29,.14);
      border-color:#fecaca;
    }
    .stepBtn.active{
      background:linear-gradient(135deg,#7a0f1f,#b91c1c,#f97316);
      border-color:#7a0f1f;
      color:#fff;
      box-shadow:0 14px 26px rgba(185,28,28,.32);
    }
    .stepLeft{display:flex; gap:10px; min-width:0}
    .stepNum{
      width:28px;height:28px;border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      font-weight:900;
      background:#fff5f5;
      border:2px solid #fecaca;
      color:#7f1d1d;
      flex:0 0 auto;
    }
    .stepBtn.active .stepNum{
      background:#fff;
      border-color:rgba(255,255,255,.55);
      color:#b91c1c;
    }
    .stepText{min-width:0}
    .stepText .mainT{font-weight:900; font-size:.9rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .stepText .subT{font-size:.78rem; opacity:.9}
    .stepArrow{font-weight:900; opacity:.9}

    .view{
      display:flex;
      flex-direction:column;
      gap:12px;
      overflow:hidden;
      min-height:0;
    }

    .card{
      background:rgba(255,255,255,.95);
      border:1px solid var(--border);
      border-radius:22px;
      box-shadow:var(--shadow2);
      overflow:hidden;
    }
    .cardHd{
      padding:10px 12px;
      border-bottom:1px solid #fee2e2;
      background:linear-gradient(180deg,#fff, #fff5f5);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .cardHd h3{
      margin:0;
      font-size:.98rem;
      color:#7f1d1d;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .cardBd{
      padding:12px;
      overflow:auto;
      min-height:0;
      max-height:calc(100vh - 180px);
    }
    @media(max-width:980px){
      .cardBd{max-height:none;}
    }

    .pill{
      display:inline-flex; align-items:center; gap:6px;
      padding:3px 10px;
      border-radius:999px;
      font-size:.78rem;
      border:1px solid #fed7d7;
      background:#fff1f2;
      color:#7f1d1d;
      font-weight:700;
    }

    .note{
      margin-top:8px;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid #fecaca;
      background:#fef2f2;
      color:#7f1d1d;
      font-size:.88rem;
    }

    .screen{display:none}
    .screen.active{display:block}

    .cover{
      position:fixed;
      inset:0;
      z-index:50;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      background:radial-gradient(circle at top, #7a0f1f 0, #b91c1c 35%, #111827 100%);
      color:#fff;
    }
    .coverInner{
      width:100%;
      max-width:1100px;
      background:rgba(17,24,39,.92);
      border:1px solid rgba(255,255,255,.16);
      border-radius:28px;
      box-shadow:0 30px 70px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .coverTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.12);
      background:linear-gradient(90deg, rgba(122,15,31,.55), rgba(185,28,28,.50), rgba(249,115,22,.35));
    }
    .coverTop .logos{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .coverTop img{
      height:42px; width:auto;
      background:#fff;
      padding:4px 8px;
      border-radius:10px;
    }
    .coverBody{
      display:grid;
      grid-template-columns:minmax(0,1.4fr) minmax(0,1fr);
      gap:16px;
      padding:16px;
    }
    @media(max-width:900px){ .coverBody{grid-template-columns:1fr} }
    .coverTitle{
      margin:0;
      font-size:1.7rem;
      line-height:1.1;
    }
    .coverSub{
      margin:8px 0 0;
      color:#e5e7eb;
      font-size:.95rem;
    }
    .coverMeta{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .coverMeta .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
      font-size:.8rem;
      color:#fff;
    }
    .gradeBtns{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;
    }
    .coverRight{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.14);
      border-radius:22px;
      padding:12px;
    }
    .coverRight h4{margin:0 0 6px; font-size:1rem}
    .bullets{margin:0; padding-left:18px; color:#e5e7eb; font-size:.9rem}
    .bullets li{margin-bottom:6px}
    .credits{
      padding:10px 14px;
      border-top:1px solid rgba(255,255,255,.12);
      font-size:.82rem;
      color:#e5e7eb;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .credits em{color:#fcd34d}
    .credits strong{color:#fff}

    .schoolFixed{
      position:fixed;
      right:16px;
      bottom:12px;
      height:80px;
      opacity:.95;
      z-index:10;
      pointer-events:none;
      filter:drop-shadow(0 10px 22px rgba(0,0,0,.25));
    }

    .infoGrid{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:12px;
    }
    @media(max-width:980px){ .infoGrid{grid-template-columns:1fr} }

    .infoCard{
      border-radius:18px;
      border:1px solid #e5e7eb;
      background:#fff;
      overflow:hidden;
      box-shadow:0 12px 22px rgba(15,23,42,.06);
    }
    .infoHd{
      padding:10px 12px;
      background:linear-gradient(135deg,#fff, #fff5f5);
      border-bottom:1px solid #fee2e2;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .infoHd strong{color:#7f1d1d}
    .infoBd{padding:10px 12px; font-size:.9rem; color:#374151}
    .infoBd ul{margin:8px 0 0; padding-left:18px}
    .infoBd li{margin-bottom:5px}

    .uiMock{
      margin-top:10px;
      border-radius:14px;
      border:1px solid #e5e7eb;
      overflow:hidden;
      background:#fff;
    }
    .mockTop{
      padding:8px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      font-size:.82rem;
      color:#6b7280;
      background:#f9fafb;
      border-bottom:1px solid #e5e7eb;
    }
    .mockTop .dots{
      display:flex; gap:6px; align-items:center
    }
    .mockTop .dots span{
      width:10px;height:10px;border-radius:50%;
      background:#e5e7eb;
    }
    .mockBody{padding:10px}
    .paper{
      background:linear-gradient(180deg,#fff,#fff7ed);
      border:1px dashed #f59e0b55;
      border-radius:12px;
      padding:10px;
      font-family:ui-serif, Georgia, "Times New Roman", serif;
      color:#7c2d12;
      font-size:.92rem;
    }
    .gmail{
      border-radius:12px;
      border:1px solid #e5e7eb;
      overflow:hidden;
    }
    .gmail .bar{
      background:#fff;
      border-bottom:1px solid #e5e7eb;
      padding:8px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:.84rem;
    }
    .gmail .list{
      padding:8px 10px;
      background:#f9fafb;
      font-size:.84rem;
      color:#374151;
    }
    .gmail .mail{
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:12px;
      padding:8px 10px;
      margin-top:8px;
    }
    .wa{
      border-radius:12px;
      overflow:hidden;
      border:1px solid #e5e7eb;
      background:#e5ddd5;
    }
    .wa .bar{
      background:#075e54;
      color:#fff;
      padding:8px 10px;
      font-size:.84rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .wa .chat{
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      background:
        radial-gradient(circle at 20% 0, rgba(255,255,255,.08) 0, transparent 35%),
        #e5ddd5;
    }
    .bubble{
      max-width:85%;
      padding:8px 10px;
      border-radius:14px;
      font-size:.86rem;
      box-shadow:0 6px 14px rgba(0,0,0,.08);
    }
    .bubble.me{
      background:#dcf8c6;
      align-self:flex-end;
      border-top-right-radius:6px;
    }
    .bubble.them{
      background:#fff;
      align-self:flex-start;
      border-top-left-radius:6px;
    }

    .footer{
      flex:0 0 auto;
      padding:8px 12px;
      font-size:.8rem;
      color:#6b7280;
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
      border-top:1px solid #fee2e2;
      background:rgba(255,255,255,.75);
      backdrop-filter: blur(6px);
    }
    .footer strong{color:#111827}
    .footer em{color:#7f1d1d}

    .panelBody::-webkit-scrollbar,
    .cardBd::-webkit-scrollbar{
      width:10px;
    }
    .panelBody::-webkit-scrollbar-thumb,
    .cardBd::-webkit-scrollbar-thumb{
      background:#fecaca;
      border-radius:999px;
      border:3px solid transparent;
      background-clip:content-box;
    }

    .muted{color:var(--muted)}
    .hr{height:1px;background:#fee2e2;margin:10px 0}
    .kpiRow{display:flex;gap:8px;flex-wrap:wrap}
    .kpi{
      border-radius:999px;
      background:#fff1f2;
      border:1px solid #fed7d7;
      padding:4px 10px;
      font-size:.8rem;
      color:#7f1d1d;
      font-weight:800;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .kpi b{color:#111827}

    /* --- Estilos para reactivos --- */
    .options-grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:8px;
    }
    @media(max-width:600px){ .options-grid{grid-template-columns:1fr} }

    .option-card{
      display:flex;
      align-items:center;
      gap:8px;
      border:1px solid #fee2e2;
      background:#fff;
      padding:8px 10px;
      border-radius:14px;
      cursor:pointer;
      user-select:none;
      box-shadow:0 6px 14px rgba(127,29,29,.06);
    }
    .option-card input{accent-color: var(--rojo); transform:scale(1.1)}
    .option-card:hover{border-color:#fecaca}

    .true-false-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:8px 10px;
      border-radius:14px;
      background:#fff;
      margin-bottom:8px;
    }
  </style>
</head>

<body>
  <img src="../../img/escudo_escuela.png" alt="Escudo escuela" class="schoolFixed">

  <!-- ========== PORTADA ========== -->
  <section class="cover" id="cover">
    <div class="coverInner">
      <div class="coverTop">
        <div class="logos">
          <img src="../../img/sep_logo.png" alt="SEP">
          <img src="../../img/escudo_escuela.png" alt="Escuela">
        </div>
        <div class="badge"><span class="dot"></span> Lenguajes ¬∑ Fase 5 ¬∑ Contenido 10</div>
      </div>

      <div class="coverBody">
        <div>
          <h1 class="coverTitle">‚úâÔ∏è De la carta al WhatsApp</h1>
          <p class="coverSub">
            ODA interactiva para <strong>Producci√≥n y env√≠o de cartas personales</strong>.
            Aprender√°s a reconocer y usar <strong>carta</strong>, <strong>email</strong> y <strong>mensajer√≠a instant√°nea</strong>
            seg√∫n el destinatario y el prop√≥sito.
          </p>

          <div class="coverMeta">
            <span class="tag">üß© 2 actividades por PDA</span>
            <span class="tag">üéÆ Interfaces tipo app real</span>
            <span class="tag">üßæ Resultados + Diploma</span>
            <span class="tag">üîÅ 2 intentos por actividad</span>
          </div>

          <div class="gradeBtns">
            <button class="btn btnPrimary" id="btnStart5">‚úâÔ∏è Entrar a 5.¬∫</button>
            <button class="btn btnPrimary" id="btnStart6">üìß Entrar a 6.¬∫</button>
            <button class="btn btnGhost" id="btnHow">‚ÑπÔ∏è ¬øQu√© har√© aqu√≠?</button>
          </div>

          <div class="note" id="coverNote" style="display:none">
            ‚úÖ Primero leer√°s una <strong>hoja informativa</strong> sobre medios de comunicaci√≥n,
            luego entrar√°s a los <strong>PDA</strong> y resolver√°s <strong>2 actividades</strong> por cada uno.
            Al final podr√°s <strong>imprimir resultados</strong> y tu <strong>diploma</strong>.
          </div>
        </div>

        <div class="coverRight">
          <h4>üë®‚Äçüè´ Tu gu√≠a</h4>
          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <img src="../../img/avatar_guia.png" alt="Avatar gu√≠a" style="width:110px;height:auto;filter:drop-shadow(0 12px 22px rgba(0,0,0,.25))">
            <div style="min-width:220px;flex:1">
              <p style="margin:0 0 6px; color:#e5e7eb; font-size:.92rem;">
                <strong style="color:#fcd34d;">Hola, soy tu gu√≠a.</strong><br>
                Hoy aprender√°s a comunicarte de forma clara y respetuosa, eligiendo el medio adecuado.
              </p>
              <ul class="bullets">
                <li>Identificar√°s tipos de mensajes.</li>
                <li>Comparar√°s carta postal, email y chat.</li>
                <li>Usar√°s adverbios de tiempo y lugar (6.¬∫).</li>
              </ul>
            </div>
          </div>

          <div class="hr" style="background:rgba(255,255,255,.12)"></div>

          <p style="margin:0; color:#e5e7eb; font-size:.86rem;">
            <strong style="color:#fff;">Tip:</strong> escribe tu nombre en la barra lateral para que aparezca en resultados.
          </p>
        </div>
      </div>

      <div class="credits">
        <div>
          <strong>Autor:</strong> Mtro. Mart√≠n Reta ¬∑ Escuela Primaria ‚ÄúGral. L√°zaro C√°rdenas‚Äù ¬∑ Ejido Santa Mar√≠a, Pesquer√≠a, N.L.
        </div>
        <div>
          <em>ODA creada por el Maestro Mart√≠n Reta</em> ¬∑ ¬© <span id="yearCover"></span>
        </div>
      </div>
    </div>
  </section>

  <!-- ========== APP ========== -->
  <div class="app" id="app" style="display:none">
    <div class="topbar">
      <img class="sep" src="../../img/sep_logo.png" alt="SEP">
      <div class="title">
        <h1>üìÆ ODA Lenguajes ¬∑ Contenido 10 <span style="opacity:.9">|</span> <span style="font-weight:900">Cartas, Email y Mensajer√≠a</span></h1>
        <div class="badge"><span class="dot"></span> Ruta: Hoja informativa ‚Üí PDA ‚Üí Actividades ‚Üí Resultados ‚Üí Diploma</div>
      </div>
      <div class="right">
        <div class="avatarChip">
          <img src="../../img/avatar_guia.png" alt="Gu√≠a">
          <div class="txt">
            <strong>Gu√≠a</strong>
            <span id="chipGrade">Sin grado</span>
          </div>
        </div>
        <button class="btn btnGhost btnMini" id="btnBackCover">üè† Portada</button>
      </div>
    </div>

    <div class="main">
      <!-- ===== SIDEBAR ===== -->
      <aside class="panel">
        <div class="panelHeader">
          <h2>üß≠ Navegaci√≥n</h2>
          <span class="pill" id="attemptPill">Intentos: ‚Äî</span>
        </div>

        <div class="panelBody">
          <div class="row" style="margin-bottom:8px">
            <div style="flex:1; min-width:220px">
              <label class="small" for="studentName">Nombre del alumno(a)</label>
              <input class="txt" id="studentName" placeholder="Escribe tu nombre aqu√≠" />
            </div>
          </div>

          <div class="kpiRow" style="margin-bottom:10px">
            <span class="kpi">Grado: <b id="kpiGrade">‚Äî</b></span>
            <span class="kpi">PDA: <b id="kpiPDA">‚Äî</b></span>
            <span class="kpi">Progreso: <b id="kpiProg">0%</b></span>
          </div>

          <div class="hr"></div>

          <div class="steps" id="navSteps"></div>

          <div class="hr"></div>

          <div class="row">
            <button class="btn btnPrimary" id="btnResults">üßæ Ver resultados</button>
            <button class="btn btnSoft" id="btnReset">üîÑ Reiniciar ODA</button>
          </div>

          <div class="note" style="margin-top:10px">
            üß† <strong>Regla:</strong> cada actividad tiene <strong>m√°ximo 2 intentos</strong>.
          </div>
        </div>
      </aside>

      <!-- ===== CONTENT ===== -->
      <section class="view">
        <div class="card">
          <div class="cardHd">
            <h3 id="viewTitle">üìò Bienvenido</h3>
            <div class="row">
              <span class="pill" id="viewTag">‚Äî</span>
              <button class="btn btnGhost btnMini" id="btnPrintResults">üñ®Ô∏è Imprimir resultados</button>
              <button class="btn btnGhost btnMini" id="btnPrintDiploma">üèÖ Imprimir diploma</button>
            </div>
          </div>

          <div class="cardBd">
            <!-- Hoja informativa -->
            <div class="screen active" id="screen-info">
              <div class="pill">Hoja informativa</div>
              <h2 style="margin:10px 0 6px;color:#7f1d1d">üì° Formas de comunicaci√≥n personal</h2>
              <p class="muted" style="margin:0 0 10px">
                Observa estas tres formas de comunicaci√≥n. Luego, en las actividades, usar√°s <strong>interfaces realistas</strong>
                (carta, email y chat) para aprender jugando.
              </p>

              <div class="infoGrid">
                <!-- Carta -->
                <div class="infoCard">
                  <div class="infoHd">
                    <strong>üìú Carta personal</strong>
                    <span class="pill">M√°s tradicional</span>
                  </div>
                  <div class="infoBd">
                    <div><strong>¬øQu√© es?</strong> Un mensaje escrito con intenci√≥n afectiva o personal.</div>
                    <ul>
                      <li>Sirve para <strong>expresar sentimientos</strong> y contar experiencias.</li>
                      <li>Puede ser <strong>postal</strong> (en sobre) o <strong>literaria</strong> (en cuentos, novelas).</li>
                      <li>Incluye: <strong>fecha, saludo, cuerpo, despedida y firma</strong>.</li>
                    </ul>

                    <div class="uiMock">
                      <div class="mockTop">
                        <span>Vista previa</span>
                        <div class="dots"><span></span><span></span><span></span></div>
                      </div>
                      <div class="mockBody">
                        <div class="paper">
                          <div style="display:flex;justify-content:space-between;gap:10px">
                            <span><strong>Santa Mar√≠a</strong></span>
                            <span><em>Hace tiempo...</em></span>
                          </div>
                          <div style="margin-top:6px"><strong>Querida/o...</strong></div>
                          <div style="margin-top:6px">
                            Hoy quiero contarte algo que pas√≥ <strong>aqu√≠</strong> en la escuela...
                          </div>
                          <div style="margin-top:8px"><em>Con cari√±o,</em><br><strong>Tu nombre</strong></div>
                        </div>
                      </div>
                    </div>

                    <div class="row" style="margin-top:10px">
                      <button class="btn btnPrimary btnMini" id="btnInfoCarta">‚úâÔ∏è Ver ejemplo</button>
                    </div>
                  </div>
                </div>

                <!-- Email -->
                <div class="infoCard">
                  <div class="infoHd">
                    <strong>üìß Correo electr√≥nico (Email)</strong>
                    <span class="pill">M√°s formal</span>
                  </div>
                  <div class="infoBd">
                    <div><strong>¬øQu√© es?</strong> Mensaje digital que se env√≠a por internet.</div>
                    <ul>
                      <li>√ötil para <strong>pedir informaci√≥n</strong>, enviar avisos o tareas.</li>
                      <li>Incluye: <strong>Para, Asunto y Mensaje</strong>.</li>
                      <li>Ventaja: puede llegar r√°pido y adjuntar archivos.</li>
                    </ul>

                    <div class="uiMock">
                      <div class="mockTop">
                        <span>Bandeja de entrada</span>
                        <div class="dots"><span></span><span></span><span></span></div>
                      </div>
                      <div class="mockBody">
                        <div class="gmail">
                          <div class="bar">
                            <strong style="color:#7f1d1d">Correo</strong>
                            <span class="muted">üõú En l√≠nea</span>
                          </div>
                          <div class="list">
                            <div class="mail">
                              <div style="display:flex;justify-content:space-between;gap:10px">
                                <strong>Asunto:</strong><span class="muted">Trabajo de Lenguajes</span>
                              </div>
                              <div style="margin-top:4px" class="muted">
                                Hola, profe. Le env√≠o mi actividad...
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="row" style="margin-top:10px">
                      <button class="btn btnPrimary btnMini" id="btnInfoEmail">üìß Abrir correo</button>
                    </div>
                  </div>
                </div>

                <!-- WhatsApp -->
                <div class="infoCard">
                  <div class="infoHd">
                    <strong>üí¨ Mensajer√≠a instant√°nea</strong>
                    <span class="pill">R√°pida</span>
                  </div>
                  <div class="infoBd">
                    <div><strong>¬øQu√© es?</strong> Mensajes cortos y r√°pidos en apps de chat.</div>
                    <ul>
                      <li>Sirve para avisos r√°pidos y conversaci√≥n cotidiana.</li>
                      <li>Se usan <strong>emojis</strong>, audios, stickers y respuestas r√°pidas.</li>
                      <li>Importante: escribir con respeto y claridad.</li>
                    </ul>

                    <div class="uiMock">
                      <div class="mockTop">
                        <span>Chat</span>
                        <div class="dots"><span></span><span></span><span></span></div>
                      </div>
                      <div class="mockBody">
                        <div class="wa">
                          <div class="bar">
                            <strong>Amigo/a</strong>
                            <span>üì∂</span>
                          </div>
                          <div class="chat">
                            <div class="bubble them">¬øD√≥nde est√°s?</div>
                            <div class="bubble me">Estoy <strong>aqu√≠</strong>, llego luego üôÇ</div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="row" style="margin-top:10px">
                      <button class="btn btnPrimary btnMini" id="btnInfoChat">üí¨ Entrar al chat</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="note" style="margin-top:12px">
                ‚úÖ Cuando est√©s listo, usa la barra izquierda para entrar al <strong>PDA 1</strong> y comenzar.
              </div>
            </div>

            <!-- placeholders; se llenan en Parte 2/3 -->
            <div class="screen" id="screen-placeholder"></div>
          </div>
        </div>

        <div class="footer">
          <div><strong>Autor:</strong> Mtro. Mart√≠n Reta ¬∑ <em>ODA creada por el Maestro Mart√≠n Reta</em></div>
          <div>¬© <span id="year"></span> ¬∑ Campo formativo: <strong>Lenguajes</strong></div>
        </div>
      </section>
    </div>
  </div>

  <script>
    /* ==========================================================
       PARTE 1/3 (Base + Hoja informativa)
       - PARTE 2/3: CONTENIDOS + PDAs (5¬∫ y 6¬∫ CORREGIDOS) + UI de actividades
       - PARTE 3/3: Motor evaluaci√≥n real + 2 intentos + resultados + diploma + impresi√≥n
       ========================================================== */

    const $ = (q, el=document) => el.querySelector(q);
    const $$ = (q, el=document) => Array.from(el.querySelectorAll(q));

    const nowYear = new Date().getFullYear();
    $("#year").textContent = nowYear;
    $("#yearCover").textContent = nowYear;

    const APP = {
      grade: null,       // "5" | "6"
      student: "",
      route: [],
      currentKey: "info",
      attempts: {},
      scores: {},
      maxAttempts: 2
    };

    function setChipGrade(){
      $("#chipGrade").textContent = APP.grade ? (APP.grade==="5" ? "5.¬∫ grado" : "6.¬∫ grado") : "Sin grado";
      $("#kpiGrade").textContent = APP.grade ? (APP.grade==="5" ? "5.¬∫" : "6.¬∫") : "‚Äî";
    }

    function setHeader(title, tag){
      $("#viewTitle").textContent = title || "üìò";
      $("#viewTag").textContent = tag || "‚Äî";
    }

    function showScreen(id){
      $$(".screen").forEach(s=>s.classList.remove("active"));
      const el = $("#"+id);
      if(el) el.classList.add("active");
    }

    function updateStudent(){
      APP.student = ($("#studentName").value || "").trim();
    }
    $("#studentName").addEventListener("input", updateStudent);

    // Cover helpers
    $("#btnHow").addEventListener("click", ()=>{
      const n = $("#coverNote");
      n.style.display = (n.style.display==="none") ? "block" : "none";
    });

    $("#btnBackCover").addEventListener("click", ()=>{
      $("#app").style.display = "none";
      $("#cover").style.display = "flex";
      APP.grade = null;
      setChipGrade();
    });

    // Botones info (solo mensajes; lo ‚Äúreal‚Äù est√° en actividades)
    $("#btnInfoCarta").addEventListener("click", ()=>alert("En las actividades ver√°s una carta realista para completar y enviar."));
    $("#btnInfoEmail").addEventListener("click", ()=>alert("En las actividades usar√°s una interfaz tipo Gmail con Para/Asunto/Mensaje."));
    $("#btnInfoChat").addEventListener("click", ()=>alert("En las actividades ver√°s pantallas tipo WhatsApp para elegir destinatario y completar mensajes."));

    // Impresi√≥n (se habilita realmente en Parte 3)
    $("#btnPrintResults").addEventListener("click", ()=>alert("La impresi√≥n de resultados se activa en la PARTE 3."));
    $("#btnPrintDiploma").addEventListener("click", ()=>alert("La impresi√≥n del diploma se activa en la PARTE 3."));

    // Nav (Parte 2 la reemplaza con PDAs)
    function buildNavPlaceholder(){
      const nav = $("#navSteps");
      nav.innerHTML = "";

      const base = [
        {key:"info", title:"Hoja informativa", sub:"Carta ¬∑ Email ¬∑ Chat", icon:"üìò"},
        {key:"results", title:"Resultados", sub:"Puntajes y logros", icon:"üßæ"},
        {key:"diploma", title:"Diploma", sub:"Imprime tu reconocimiento", icon:"üèÖ"}
      ];
      APP.route = base;

      APP.route.forEach((s, idx)=>{
        const btn = document.createElement("button");
        btn.className = "stepBtn" + (s.key==="info" ? " active":"");
        btn.dataset.key = s.key;
        btn.innerHTML = `
          <div class="stepLeft">
            <div class="stepNum">${idx+1}</div>
            <div class="stepText">
              <div class="mainT">${s.icon} ${s.title}</div>
              <div class="subT">${s.sub}</div>
            </div>
          </div>
          <div class="stepArrow">‚ûú</div>
        `;
        btn.addEventListener("click", ()=>go(s.key));
        nav.appendChild(btn);
      });

      $("#kpiPDA").textContent = "Info";
      $("#kpiProg").textContent = "0%";
      $("#attemptPill").textContent = "Intentos: 0/‚Äî";
    }

    function setActiveNav(key){
      $$(".stepBtn").forEach(b=>b.classList.toggle("active", b.dataset.key===key));
    }

    function go(key){
      APP.currentKey = key;
      setActiveNav(key);

      if(key==="info"){
        setHeader("üìò Hoja informativa: formas de comunicaci√≥n", "Exploro");
        $("#kpiPDA").textContent = "Info";
        showScreen("screen-info");
      }else{
        setHeader("‚è≥ En construcci√≥n", "‚Äî");
        showScreen("screen-placeholder");
        $("#screen-placeholder").innerHTML = `
          <div class="pill">A√∫n no</div>
          <h2 style="margin:10px 0 6px;color:#7f1d1d">‚è≥ Esta secci√≥n se habilita en PARTE 2/3 y PARTE 3/3</h2>
          <p class="muted" style="margin:0">Pega las partes restantes debajo para activar todo.</p>
        `;
      }
    }

    function startGrade(g){
      APP.grade = g;
      setChipGrade();
      $("#cover").style.display = "none";
      $("#app").style.display = "block";

      // En Parte 2 se construye la navegaci√≥n real por PDA
      buildNavPlaceholder();
      go("info");
    }

    $("#btnStart5").addEventListener("click", ()=>startGrade("5"));
    $("#btnStart6").addEventListener("click", ()=>startGrade("6"));

    $("#btnResults").addEventListener("click", ()=>go("results"));
    $("#btnReset").addEventListener("click", ()=>{
      if(!confirm("¬øReiniciar ODA? Se borrar√°n intentos y resultados.")) return;
      APP.attempts = {};
      APP.scores = {};
      $("#attemptPill").textContent = "Intentos: 0/‚Äî";
      $("#kpiProg").textContent = "0%";
      go("info");
    });

    // Inicial
    buildNavPlaceholder();
    setHeader("üìò Hoja informativa: formas de comunicaci√≥n", "Exploro");
  </script>
  <!-- =======================
       PARTE 2/3 (CORREGIDA)
       - DATA: PDAs 5¬∫ y 6¬∫ (6¬∫ ya NO toma los de 5¬∫)
       - UI: pantallas por PDA con 2 actividades (1 sencilla + 1 din√°mica)
       - Navegaci√≥n completa (Info ‚Üí PDAs ‚Üí Resultados ‚Üí Diploma)
  ======================== -->
  <script>
    /* =========================
       CONTENIDO 10 (DATA)
       ========================= */

    const CONTENT10 = {
      meta:{
        field:"Lenguajes",
        phase:"Fase 5",
        content:"Contenido 10: Producci√≥n y env√≠o de cartas personales"
      },

      /* =========================
         QUINTO (5¬∫)
         ========================= */
      grade5:{
        pda:[
          {
            key:"pda1",
            title:"PDA 1",
            subtitle:"Lee cartas personales reales y literarias.",
            pdaLiteral:"Lee distintas cartas personales reales y literarias.",
            a1:{
              id:"5_pda1_a1",
              title:"Actividad 1 (Sencilla): ¬øQu√© tipo de texto es?",
              hint:"Lee cada fragmento y elige si parece una carta real o una carta literaria.",
              type:"mcq",
              items:[
                {q:"‚ÄúQuerida abuela: hoy te extra√±o mucho y te mando un abrazo‚Ä¶‚Äù", options:["Carta real","Carta literaria"], answer:0},
                {q:"‚ÄúY entonces el capit√°n escribi√≥ una carta que nunca enviar√≠a‚Ä¶‚Äù", options:["Carta real","Carta literaria"], answer:1},
                {q:"‚ÄúHola, Luis. Te escribo para contarte c√≥mo me fue en el partido‚Ä¶‚Äù", options:["Carta real","Carta literaria"], answer:0},
                {q:"‚ÄúEn el viejo caj√≥n, una carta narraba los secretos del pueblo‚Ä¶‚Äù", options:["Carta real","Carta literaria"], answer:1},
                {q:"‚ÄúMam√°: gracias por cuidarme. Te quiero.‚Äù", options:["Carta real","Carta literaria"], answer:0}
              ]
            },
            a2:{
              id:"5_pda1_a2",
              title:"Actividad 2 (Din√°mica): Detectives de mensajes (clasifica)",
              hint:"Clasifica cada tarjeta en: üìú Carta real o üìñ Carta literaria.",
              type:"dragClassify",
              bins:[
                {key:"real", label:"üìú Carta real"},
                {key:"lit", label:"üìñ Carta literaria"}
              ],
              cards:[
                {id:"c1", text:"Querida prima: hace tiempo no te escribo. ¬øC√≥mo est√°s all√°?", bin:"real"},
                {id:"c2", text:"El h√©roe dej√≥ una carta en la mesa, como si fuera una pista del destino.", bin:"lit"},
                {id:"c3", text:"Hola pap√°: aqu√≠ todo va bien. Ma√±ana te cuento m√°s.", bin:"real"},
                {id:"c4", text:"La carta susurraba historias antiguas, escrita por una mano desconocida.", bin:"lit"},
                {id:"c5", text:"Amiga: ayer pens√© en ti. Te mando saludos desde ac√°.", bin:"real"},
                {id:"c6", text:"En la novela, la carta cambi√≥ el rumbo de la aventura.", bin:"lit"}
              ]
            }
          },

          {
            key:"pda2",
            title:"PDA 2",
            subtitle:"Caracter√≠sticas y funciones: correo postal y electr√≥nico.",
            pdaLiteral:"Reflexiona sobre las caracter√≠sticas y funciones de las cartas personales enviadas por correo postal y electr√≥nico.",
            a1:{
              id:"5_pda2_a1",
              title:"Actividad 1 (Sencilla): ¬øPara qu√© sirve este mensaje?",
              hint:"Elige la funci√≥n principal del mensaje.",
              type:"mcq",
              items:[
                {q:"‚ÄúTe escribo para felicitarte por tu cumplea√±os.‚Äù", options:["Informar","Felicitar","Pedir"], answer:1},
                {q:"‚Äú¬øPodr√≠as decirme a qu√© hora es la reuni√≥n?‚Äù", options:["Pedir","Felicitar","Narrar"], answer:0},
                {q:"‚ÄúTe cuento c√≥mo me fue en la escuela hoy.‚Äù", options:["Narrar experiencia","Pedir","Dar instrucciones"], answer:0},
                {q:"‚ÄúTe aviso que ma√±ana no podr√© ir.‚Äù", options:["Informar","Felicitar","Invitar"], answer:0},
                {q:"‚ÄúTe invito a mi partido del viernes.‚Äù", options:["Invitar","Pedir","Despedir"], answer:0}
              ]
            },
            a2:{
              id:"5_pda2_a2",
              title:"Actividad 2 (Din√°mica): Mini-Gmail (elige el mejor medio)",
              hint:"Completa el correo y luego elige si conviene enviarlo por üì¨ Postal o üìß Email.",
              type:"emailMini",
              scenarios:[
                {id:"s1", to:"mam√°@casa.com", subject:"Aviso r√°pido", body:"Hola mam√°, ma√±ana salgo m√°s tarde. Te aviso por aqu√≠.", best:"email"},
                {id:"s2", to:"abuela@cari√±o.com", subject:"Te extra√±o", body:"Querida abuela, hace tiempo no te escribo. Te mando un abrazo.", best:"postal"},
                {id:"s3", to:"equipo@escuela.com", subject:"Tarea", body:"Buenas tardes, env√≠o mi actividad de Lenguajes adjunta.", best:"email"},
                {id:"s4", to:"amigo@chat.com", subject:"Gracias", body:"Amigo, gracias por ayudarme. Me sent√≠ muy feliz.", best:"postal"},
                {id:"s5", to:"profe@escuela.com", subject:"Duda", body:"Profe, ¬øpodr√≠a decirme la fecha de entrega, por favor?", best:"email"}
              ]
            }
          },

          {
            key:"pda3",
            title:"PDA 3",
            subtitle:"Expresa sentimientos, ideas y experiencias pensando en destinatarios.",
            pdaLiteral:"Expresa sentimientos, ideas y experiencias por medio de cartas, pensando en destinatarias y destinatarios espec√≠ficos.",
            a1:{
              id:"5_pda3_a1",
              title:"Actividad 1 (Sencilla): ¬øA qui√©n va dirigido?",
              hint:"Lee la situaci√≥n y elige el destinatario m√°s adecuado.",
              type:"mcq",
              items:[
                {q:"Quieres agradecer por un regalo.", options:["Director","Abuela","Desconocido"], answer:1},
                {q:"Quieres pedir informaci√≥n de una tarea.", options:["Maestra/o","Vecino","Primo"], answer:0},
                {q:"Quieres contar una aventura divertida.", options:["Mejor amigo/a","Dentista","Polic√≠a"], answer:0},
                {q:"Quieres invitar a un evento escolar.", options:["Familia","Jugador profesional","Robot"], answer:0},
                {q:"Quieres disculparte por un error.", options:["Amigo/a","Planeta","√Årbol"], answer:0}
              ]
            },
            a2:{
              id:"5_pda3_a2",
              title:"Actividad 2 (Din√°mica): WhatsApp ‚Äì Elige el chat correcto",
              hint:"Elige el chat correcto para cada situaci√≥n (simulaci√≥n tipo WhatsApp).",
              type:"waChooseChat",
              chats:[
                {key:"mama", name:"Mam√°"},
                {key:"amigo", name:"Mejor amigo/a"},
                {key:"profe", name:"Maestra/o"},
                {key:"abuela", name:"Abuela"}
              ],
              situations:[
                {id:"w1", text:"Necesitas pedir la fecha de entrega de una actividad.", correct:"profe"},
                {id:"w2", text:"Quieres contar algo divertido que pas√≥ hoy.", correct:"amigo"},
                {id:"w3", text:"Quieres avisar que llegar√°s despu√©s.", correct:"mama"},
                {id:"w4", text:"Quieres expresar cari√±o y recuerdos.", correct:"abuela"},
                {id:"w5", text:"Quieres pedir permiso para ir a un partido.", correct:"mama"}
              ]
            }
          },

          {
            key:"pda4",
            title:"PDA 4",
            subtitle:"Reconoce palabras de tiempo y espacio (all√°, aqu√≠, ah√≠, ac√°, hace tiempo).",
            pdaLiteral:"Reconoce palabras y expresiones que se√±alan tiempo y espacio en las cartas personales: all√°, aqu√≠, ah√≠, ac√°, hace tiempo.",
            a1:{
              id:"5_pda4_a1",
              title:"Actividad 1 (Sencilla): Tiempo o lugar",
              hint:"Clasifica: ¬øse usa m√°s para tiempo o para lugar?",
              type:"mcq",
              items:[
                {q:"aqu√≠", options:["Tiempo","Lugar"], answer:1},
                {q:"all√°", options:["Tiempo","Lugar"], answer:1},
                {q:"hace tiempo", options:["Tiempo","Lugar"], answer:0},
                {q:"ac√°", options:["Tiempo","Lugar"], answer:1},
                {q:"ah√≠", options:["Tiempo","Lugar"], answer:1}
              ]
            },
            a2:{
              id:"5_pda4_a2",
              title:"Actividad 2 (Din√°mica): Carta con huecos (men√∫s)",
              hint:"Elige la palabra correcta para cada espacio.",
              type:"dragFill",
              wordBank:["aqu√≠","all√°","ah√≠","ac√°","hace tiempo"],
              textTemplate:
                "Querida Ana:\n\n____ no te escrib√≠a. Te extra√±o mucho.\nYo estoy ____ en la escuela, y pienso en ti cuando est√°s ____.\n¬øRecuerdas cuando jug√°bamos ____ en el patio?\nTe mando un abrazo.\n\nCon cari√±o,\nTu amigo/a",
              blanks:[
                {index:0, answer:"hace tiempo"},
                {index:1, answer:"aqu√≠"},
                {index:2, answer:"all√°"},
                {index:3, answer:"ac√°"}
              ]
            }
          },

          {
            key:"pda5",
            title:"PDA 5",
            subtitle:"Env√≠a cartas por correo postal y/o electr√≥nico.",
            pdaLiteral:"Env√≠a las cartas que escribe a trav√©s del correo postal y/o electr√≥nico.",
            a1:{
              id:"5_pda5_a1",
              title:"Actividad 1 (Sencilla): Ordena el proceso",
              hint:"Selecciona el orden correcto del env√≠o.",
              type:"orderSelect",
              steps:["Escribir el mensaje","Elegir medio (postal/email)","Poner destinatario","Enviar","Recibir respuesta"]
            },
            a2:{
              id:"5_pda5_a2",
              title:"Actividad 2 (Din√°mica): Ruta del env√≠o (men√∫s por paso)",
              hint:"Elige el paso correcto en cada posici√≥n.",
              type:"dragOrder",
              steps:["Escribir","Revisar","Elegir medio","Colocar datos (Para/Direcci√≥n)","Enviar","Confirmaci√≥n"]
            }
          }
        ]
      },

      /* =========================
         SEXTO (6¬∫)  ‚úÖ CORREGIDO
         ========================= */
      grade6:{
        pda:[
          {
            key:"pda1",
            title:"PDA 1",
            subtitle:"Lee cartas reales y literarias y analiza sus caracter√≠sticas.",
            pdaLiteral:"Lee distintas cartas personales reales y literarias y analiza sus caracter√≠sticas.",
            a1:{
              id:"6_pda1_a1",
              title:"Actividad 1 (Sencilla): Identifica la caracter√≠stica",
              hint:"Elige la opci√≥n que describe mejor el fragmento.",
              type:"mcq",
              items:[
                {q:"‚ÄúQuerida t√≠a: gracias por tu apoyo. Te escribo desde aqu√≠‚Ä¶‚Äù", options:["Lenguaje afectivo","Instrucciones t√©cnicas","Noticia deportiva"], answer:0},
                {q:"‚ÄúAsunto: Solicitud de informaci√≥n. Buen d√≠a‚Ä¶‚Äù", options:["Correo formal","Carta literaria","Chiste"], answer:0},
                {q:"‚ÄúLa carta revel√≥ un secreto en la historia‚Ä¶‚Äù", options:["Carta literaria","Correo formal","Reglamento"], answer:0},
                {q:"‚ÄúTe cuento c√≥mo me sent√≠ ayer‚Ä¶‚Äù", options:["Expresi√≥n personal","Publicidad","Manual"], answer:0},
                {q:"‚ÄúAdjunto el archivo con mi tarea.‚Äù", options:["Correo electr√≥nico","Carta postal","Poema"], answer:0}
              ]
            },
            a2:{
              id:"6_pda1_a2",
              title:"Actividad 2 (Din√°mica): Anatom√≠a del Email (Gmail)",
              hint:"Marca las partes correctas de un correo.",
              type:"emailAnatomy",
              parts:["Para","Asunto","Mensaje","Adjunto","Firma"],
              correctParts:["Para","Asunto","Mensaje","Firma","Adjunto"]
            }
          },

          {
            key:"pda2",
            title:"PDA 2",
            subtitle:"Similitudes/diferencias y ventajas/desventajas: postal vs electr√≥nico.",
            pdaLiteral:"Discute sobre las similitudes y diferencias, as√≠ como sobre las ventajas y desventajas del correo postal y el electr√≥nico.",
            a1:{
              id:"6_pda2_a1",
              title:"Actividad 1 (Sencilla): ¬øPostal o Email?",
              hint:"Elige el medio que conviene m√°s en cada caso.",
              type:"mcq",
              items:[
                {q:"Enviar algo urgente.", options:["Postal","Email"], answer:1},
                {q:"Enviar una carta muy personal a un familiar.", options:["Postal","Email"], answer:0},
                {q:"Mandar un archivo con tarea.", options:["Postal","Email"], answer:1},
                {q:"Mensaje corto que debe llegar hoy.", options:["Postal","Email"], answer:1},
                {q:"Detalle especial para conservar.", options:["Postal","Email"], answer:0}
              ]
            },
            a2:{
              id:"6_pda2_a2",
              title:"Actividad 2 (Din√°mica): Comparador (Postal vs Email vs Chat)",
              hint:"Clasifica cada tarjeta en la columna correcta.",
              type:"tripleClassify",
              cols:[
                {key:"postal", label:"üì¨ Postal"},
                {key:"email", label:"üìß Email"},
                {key:"chat", label:"üí¨ Chat"},
                {key:"both", label:"‚úÖ Varios"}
              ],
              cards:[
                {id:"t1", text:"Puede adjuntar archivos", col:"email"},
                {id:"t2", text:"Necesita internet", col:"email"},
                {id:"t3", text:"Se escribe a mano", col:"postal"},
                {id:"t4", text:"Sirve para avisos r√°pidos", col:"chat"},
                {id:"t5", text:"Puede expresar sentimientos", col:"both"},
                {id:"t6", text:"Puede llegar en segundos", col:"chat"},
                {id:"t7", text:"Puede conservarse como recuerdo", col:"postal"}
              ]
            }
          },

          {
            key:"pda3",
            title:"PDA 3",
            subtitle:"Estructura de direcciones postales y electr√≥nicas (destinatario/remitente).",
            pdaLiteral:"Reconoce la estructura de la informaci√≥n de las direcciones postales y electr√≥nicas de destinatarias, destinatarios y remitentes.",
            a1:{
              id:"6_pda3_a1",
              title:"Actividad 1 (Sencilla): ¬øQu√© dato falta?",
              hint:"Elige el elemento que falta en cada caso.",
              type:"mcq",
              items:[
                {q:"En una direcci√≥n postal falta el ______ para llegar al domicilio.", options:["C√≥digo postal","Emoji","Sticker"], answer:0},
                {q:"En un email, antes de @ va el ______.", options:["Nombre de usuario","C√≥digo postal","Sello"], answer:0},
                {q:"Remitente es la persona que ______ el mensaje.", options:["env√≠a","recibe","borra"], answer:0},
                {q:"Destinatario es la persona que ______ el mensaje.", options:["recibe","env√≠a","rompe"], answer:0},
                {q:"En una direcci√≥n postal suele aparecer: calle, n√∫mero, colonia, ciudad y ______.", options:["c√≥digo postal","contrase√±a","aplausos"], answer:0}
              ]
            },
            a2:{
              id:"6_pda3_a2",
              title:"Actividad 2 (Din√°mica): Arma la direcci√≥n (postal y email)",
              hint:"Clasifica cada elemento seg√∫n corresponda.",
              type:"dualAddressBuild",
              postalParts:["Nombre","Calle","N√∫mero","Colonia","Ciudad","Estado","C√≥digo postal"],
              emailParts:["Nombre de usuario","@","Dominio",".com/.mx"],
              dragParts:["Nombre","Calle","N√∫mero","Colonia","Ciudad","Estado","C√≥digo postal","Nombre de usuario","@","Dominio",".com/.mx"]
            }
          },

          {
            key:"pda4",
            title:"PDA 4",
            subtitle:"Adverbios de tiempo y lugar (ayer, hoy, ma√±ana‚Ä¶ aqu√≠, all√°, arriba, abajo).",
            pdaLiteral:"Expresa sentimientos, ideas y experiencias por medio de cartas, en funci√≥n de las destinatarias y los destinatarios y empleando adverbios de tiempo y lugar: ayer, hoy, ma√±ana, anoche, ahora, despu√©s, luego, nunca, jam√°s, aqu√≠, all√°, all√≠, arriba, abajo.",
            a1:{
              id:"6_pda4_a1",
              title:"Actividad 1 (Sencilla): Completa con adverbio",
              hint:"Selecciona el adverbio que mejor completa la oraci√≥n.",
              type:"mcq",
              items:[
                {q:"_____ voy a visitarte (no hoy).", options:["Ma√±ana","Aqu√≠","Arriba"], answer:0},
                {q:"Estoy _____ en la escuela.", options:["Aqu√≠","Ayer","Nunca"], answer:0},
                {q:"_____ te escrib√≠ y no contestaste.", options:["Ayer","Abajo","All√≠"], answer:0},
                {q:"Te llamar√© _____ de terminar.", options:["Despu√©s","Arriba","Jam√°s"], answer:0},
                {q:"No lo har√© _____ (en ning√∫n momento).", options:["Nunca","Ahora","Abajo"], answer:0}
              ]
            },
            a2:{
              id:"6_pda4_a2",
              title:"Actividad 2 (Din√°mica): Chat con men√∫s (WhatsApp)",
              hint:"Completa los mensajes eligiendo adverbios (tiempo/lugar).",
              type:"waDropdownFill",
              bank:["ayer","hoy","ma√±ana","anoche","ahora","despu√©s","luego","nunca","jam√°s","aqu√≠","all√°","all√≠","arriba","abajo"],
              messages:[
                {id:"m1", text:"Hola, ____ te vi en la cancha. ¬øVienes ____?", answers:["ayer","ma√±ana"]},
                {id:"m2", text:"Estoy ____ en mi casa ____ termino la tarea.", answers:["aqu√≠","despu√©s"]},
                {id:"m3", text:"Anoche me dorm√≠ tarde, pero ____ estoy mejor.", answers:["hoy"]},
                {id:"m4", text:"No vuelvo a hacer eso, ____.", answers:["jam√°s"]},
                {id:"m5", text:"La mochila est√° ____ de la mesa, ponla ____.", answers:["abajo","arriba"]}
              ]
            }
          },

          {
            key:"pda5",
            title:"PDA 5",
            subtitle:"Env√≠a cartas por correo postal y/o electr√≥nico.",
            pdaLiteral:"Env√≠a las cartas que escribe a trav√©s del correo postal y/o electr√≥nico.",
            a1:{
              id:"6_pda5_a1",
              title:"Actividad 1 (Sencilla): ¬øQu√© medio conviene m√°s?",
              hint:"Elige el canal m√°s adecuado.",
              type:"mcq",
              items:[
                {q:"Enviar un archivo con im√°genes.", options:["Postal","Email"], answer:1},
                {q:"Mandar un mensaje emotivo para guardar.", options:["Postal","Email"], answer:0},
                {q:"Avisar un cambio urgente de horario.", options:["Postal","Email"], answer:1},
                {q:"Pedir informaci√≥n al profesor.", options:["Postal","Email"], answer:1},
                {q:"Carta larga y personal a un familiar.", options:["Postal","Email"], answer:0}
              ]
            },
            a2:{
              id:"6_pda5_a2",
              title:"Actividad 2 (Din√°mica): Bandeja de salida (elige correcto)",
              hint:"Decide si se env√≠a como Postal o Email revisando Para/De.",
              type:"outboxSim",
              mails:[
                {id:"o1", to:"profe@escuela.edu.mx", from:"alumno@escuela.edu.mx", subject:"Duda tarea", best:"email"},
                {id:"o2", to:"Abuela (direcci√≥n postal)", from:"Tu nombre (direcci√≥n postal)", subject:"Te extra√±o", best:"postal"},
                {id:"o3", to:"equipo@escuela.edu.mx", from:"alumno@escuela.edu.mx", subject:"Env√≠o actividad", best:"email"},
                {id:"o4", to:"T√≠o (direcci√≥n postal)", from:"Tu nombre (direcci√≥n postal)", subject:"Recuerdo", best:"postal"},
                {id:"o5", to:"direccion@escuela.edu.mx", from:"alumno@escuela.edu.mx", subject:"Aviso", best:"email"}
              ]
            }
          }
        ]
      }
    };

    /* =========================
       HELPERS
       ========================= */
    function escapeHtml(str){
      return (str ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function escapeAttr(str){
      return escapeHtml(str).replaceAll("\n"," ").trim();
    }

    function gradeData(){
      return APP.grade === "5" ? CONTENT10.grade5 : CONTENT10.grade6;
    }

    /* =========================
       NAV REAL (reemplaza placeholder)
       ========================= */
    function buildNav(){
      const nav = $("#navSteps");
      nav.innerHTML = "";

      const pdaList = gradeData().pda;

      const route = [
        {key:"info", title:"Hoja informativa", sub:"Carta ¬∑ Email ¬∑ Chat", icon:"üìò"},
        ...pdaList.map((p)=>({
          key:p.key,
          title:`${p.title}`,
          sub:p.subtitle,
          icon:"üß©"
        })),
        {key:"results", title:"Resultados", sub:"Puntajes y logros", icon:"üßæ"},
        {key:"diploma", title:"Diploma", sub:"Imprime tu reconocimiento", icon:"üèÖ"}
      ];

      APP.route = route;

      APP.route.forEach((s, idx)=>{
        const btn = document.createElement("button");
        btn.className = "stepBtn" + (idx===0 ? " active":"");
        btn.dataset.key = s.key;
        btn.innerHTML = `
          <div class="stepLeft">
            <div class="stepNum">${idx+1}</div>
            <div class="stepText">
              <div class="mainT">${s.icon} ${escapeHtml(s.title)}</div>
              <div class="subT">${escapeHtml(s.sub)}</div>
            </div>
          </div>
          <div class="stepArrow">‚ûú</div>
        `;
        btn.addEventListener("click", ()=>go(s.key));
        nav.appendChild(btn);
      });

      ensurePDAScreens();
      updateKPIs();
      updateAttemptPill();
    }

    function ensurePDAScreens(){
      const host = $(".cardBd");
      const existing = new Set($$(".screen").map(s=>s.id));

      gradeData().pda.forEach((p)=>{
        const sid = `screen-${p.key}`;
        if(existing.has(sid)) return;
        const sc = document.createElement("div");
        sc.className = "screen";
        sc.id = sid;
        sc.innerHTML = renderPDA(p);
        host.appendChild(sc);
      });
    }

    function renderPDA(p){
      const tag = APP.grade==="5" ? "Quinto" : "Sexto";
      return `
        <div class="pill">${tag} grado ¬∑ ${escapeHtml(p.title)}</div>
        <h2 style="margin:10px 0 4px;color:#7f1d1d">${escapeHtml(p.subtitle)}</h2>
        <p class="muted" style="margin:0 0 10px"><strong>PDA (literal):</strong> ${escapeHtml(p.pdaLiteral)}</p>

        <div class="hr"></div>

        <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px">
          ${renderActivityBlock(p.a1, 1)}
          ${renderActivityBlock(p.a2, 2)}
        </div>

        <div class="note" style="margin-top:12px">
          ‚úÖ Cada actividad tiene <strong>m√°ximo 2 intentos</strong>. Al agotar los intentos se bloquear√°.
        </div>
      `;
    }

    function renderActivityBlock(a, n){
      const badge = (n===1) ? "Sencilla" : "Din√°mica";
      const actId = a.id;
      return `
        <div class="card" style="border-radius:18px">
          <div class="cardHd">
            <h3 style="margin:0;font-size:.95rem;color:#7f1d1d">üéÆ ${escapeHtml(a.title)}</h3>
            <span class="pill">${badge}</span>
          </div>
          <div class="cardBd" style="max-height:none">
            <p class="muted" style="margin-top:0">${escapeHtml(a.hint || "")}</p>

            ${renderActivityUI(a)}

            <div class="hr"></div>
            <div class="row">
              <button class="btn btnPrimary btnMini" data-action="check" data-activity="${actId}">‚úÖ Comprobar</button>
              <button class="btn btnGhost btnMini" data-action="reset" data-activity="${actId}">üßπ Reiniciar</button>
              <span class="pill" id="status_${actId}">Listo</span>
            </div>
          </div>
        </div>
      `;
    }

    function renderActivityUI(a){
      if(a.type==="mcq"){
        return `
          <div class="muted" style="font-size:.82rem;margin-bottom:6px">Reactivos: ${a.items.length}</div>
          ${a.items.map((it,idx)=>`
            <div style="margin:10px 0;padding:10px;border:1px solid #fee2e2;border-radius:14px;background:#fff">
              <div style="font-weight:900;color:#111827;margin-bottom:6px">${idx+1}. ${escapeHtml(it.q)}</div>
              <div class="options-grid">
                ${it.options.map((op,oi)=>`
                  <label class="option-card">
                    <input type="radio" name="${a.id}_q${idx}" value="${oi}">
                    <span>${escapeHtml(op)}</span>
                  </label>
                `).join("")}
              </div>
            </div>
          `).join("")}
        `;
      }

      if(a.type==="orderSelect"){
        const opts = a.steps.map(s=>`<option value="${escapeAttr(s)}">${escapeHtml(s)}</option>`).join("");
        return `
          <div class="muted" style="font-size:.82rem;margin-bottom:6px">Ordena: selecciona el paso correcto en cada posici√≥n.</div>
          ${a.steps.map((_,i)=>`
            <div class="true-false-row" style="border:1px solid #fee2e2">
              <span><strong>Posici√≥n ${i+1}</strong></span>
              <select data-order="${a.id}" data-slot="${i}">
                <option value="">‚Äî Elige ‚Äî</option>
                ${opts}
              </select>
            </div>
          `).join("")}
        `;
      }

      if(a.type==="dragClassify"){
        return `
          <div class="muted" style="font-size:.82rem;margin-bottom:6px">Clasifica (se eval√∫a con tus selecciones).</div>
          <div style="display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr);gap:10px">
            <div style="padding:10px;border:1px solid #fee2e2;border-radius:14px;background:#fff">
              <div style="font-weight:900;color:#7f1d1d;margin-bottom:8px">üß© Tarjetas</div>
              ${a.cards.map(c=>`
                <div style="border:1px solid #e5e7eb;border-radius:12px;padding:8px;margin-bottom:8px;background:#f9fafb">
                  <div style="font-weight:800">${escapeHtml(c.text)}</div>
                  <div style="margin-top:6px" class="row">
                    <span class="muted" style="font-size:.78rem">Col√≥cala en:</span>
                    <select data-pick="${a.id}" data-card="${c.id}">
                      <option value="">‚Äî Elegir ‚Äî</option>
                      ${a.bins.map(b=>`<option value="${b.key}">${escapeHtml(b.label)}</option>`).join("")}
                    </select>
                  </div>
                </div>
              `).join("")}
            </div>
            <div style="padding:10px;border:1px solid #fee2e2;border-radius:14px;background:#fff">
              <div style="font-weight:900;color:#7f1d1d;margin-bottom:8px">üì¶ Contenedores</div>
              ${a.bins.map(b=>`
                <div style="border:1px dashed #fca5a5;border-radius:14px;padding:10px;margin-bottom:10px;background:#fff1f2">
                  <strong>${escapeHtml(b.label)}</strong>
                  <div class="muted" style="font-size:.78rem;margin-top:4px">Selecciona arriba para ‚Äúcolocar‚Äù.</div>
                </div>
              `).join("")}
            </div>
          </div>
        `;
      }

      if(a.type==="dragFill"){
        const blanksUI = a.blanks.map((_, i)=>`
          <div class="true-false-row" style="border:1px solid #fee2e2">
            <span><strong>Espacio ${i+1}</strong></span>
            <select data-fill="${a.id}" data-blank="${i}">
              <option value="">‚Äî Elegir ‚Äî</option>
              ${a.wordBank.map(w=>`<option value="${escapeAttr(w)}">${escapeHtml(w)}</option>`).join("")}
            </select>
          </div>
        `).join("");

        return `
          <div style="border:1px solid #e5e7eb;border-radius:14px;overflow:hidden;background:#fff">
            <div style="padding:8px 10px;background:#fff5f5;border-bottom:1px solid #fee2e2;display:flex;justify-content:space-between;align-items:center;gap:10px">
              <strong style="color:#7f1d1d">‚úâÔ∏è Carta</strong>
              <span class="muted" style="font-size:.78rem">Completa los espacios</span>
            </div>
            <div style="padding:10px">
              <pre style="white-space:pre-wrap;margin:0;font-family:ui-serif,Georgia,'Times New Roman',serif;color:#7c2d12;background:linear-gradient(180deg,#fff,#fff7ed);border:1px dashed #f59e0b55;padding:10px;border-radius:12px">${escapeHtml(a.textTemplate)}</pre>
            </div>
          </div>
          <div style="margin-top:10px">${blanksUI}</div>
        `;
      }

      if(a.type==="dragOrder"){
        return `
          <div class="muted" style="font-size:.82rem;margin-bottom:6px">Ordena los pasos (por posici√≥n).</div>
          ${a.steps.map((_,i)=>`
            <div class="true-false-row" style="border:1px solid #fee2e2">
              <span><strong>Paso ${i+1}</strong></span>
              <select data-dorder="${a.id}" data-slot="${i}">
                <option value="">‚Äî Elegir ‚Äî</option>
                ${a.steps.map(s=>`<option value="${escapeAttr(s)}">${escapeHtml(s)}</option>`).join("")}
              </select>
            </div>
          `).join("")}
        `;
      }

      if(a.type==="emailMini"){
        return `
          <div class="gmail" style="border-radius:14px;border:1px solid #e5e7eb;overflow:hidden">
            <div class="bar" style="background:#fff">
              <strong style="color:#7f1d1d">üìß Mini-Gmail</strong>
              <span class="muted">Bandeja de salida</span>
            </div>
            <div class="list">
              ${a.scenarios.map((s,idx)=>`
                <div class="mail" style="margin-top:10px" data-emailcase="${a.id}" data-case="${s.id}">
                  <div class="muted" style="font-size:.78rem;margin-bottom:6px">Caso ${idx+1}</div>
                  <div style="display:grid;grid-template-columns:110px 1fr;gap:6px;font-size:.84rem">
                    <div><strong>Para:</strong></div><div>${escapeHtml(s.to)}</div>
                    <div><strong>Asunto:</strong></div><div>${escapeHtml(s.subject)}</div>
                  </div>
                  <div style="margin-top:8px;border:1px solid #e5e7eb;border-radius:12px;padding:8px;background:#f9fafb">
                    ${escapeHtml(s.body)}
                  </div>
                  <div class="row" style="margin-top:8px">
                    <span class="muted" style="font-size:.78rem">Mejor medio:</span>
                    <label class="option-card"><input type="radio" name="${a.id}_${s.id}" value="postal"><span>üì¨ Postal</span></label>
                    <label class="option-card"><input type="radio" name="${a.id}_${s.id}" value="email"><span>üìß Email</span></label>
                  </div>
                </div>
              `).join("")}
            </div>
          </div>
        `;
      }

      if(a.type==="waChooseChat"){
        return `
          <div class="wa" style="border-radius:14px;border:1px solid #e5e7eb">
            <div class="bar"><strong>üí¨ WhatsApp</strong><span>üü¢ en l√≠nea</span></div>
            <div class="chat" style="gap:10px">
              <div style="display:flex;gap:8px;flex-wrap:wrap">
                ${a.chats.map(c=>`
                  <button class="btn btnGhost btnMini" type="button">üë§ ${escapeHtml(c.name)}</button>
                `).join("")}
              </div>

              <div style="border:1px solid #e5e7eb;border-radius:12px;background:#fff;padding:10px">
                <div style="font-weight:900;color:#111827;margin-bottom:6px">Situaciones (elige el chat correcto)</div>
                ${a.situations.map((s,idx)=>`
                  <div style="border:1px solid #f3f4f6;border-radius:12px;padding:8px;margin-bottom:8px;background:#f9fafb">
                    <div style="font-weight:800">${idx+1}. ${escapeHtml(s.text)}</div>
                    <div class="row" style="margin-top:6px">
                      <span class="muted" style="font-size:.78rem">Respuesta:</span>
                      <select data-wachoose="${a.id}" data-sit="${s.id}">
                        <option value="">‚Äî Elegir chat ‚Äî</option>
                        ${a.chats.map(c=>`<option value="${c.key}">${escapeHtml(c.name)}</option>`).join("")}
                      </select>
                    </div>
                  </div>
                `).join("")}
              </div>
            </div>
          </div>
        `;
      }

      if(a.type==="emailAnatomy"){
        return `
          <div class="gmail" style="border-radius:14px;border:1px solid #e5e7eb;overflow:hidden">
            <div class="bar"><strong style="color:#7f1d1d">üìß Gmail ‚Äì Mensaje</strong><span class="muted">Selecciona partes</span></div>
            <div class="list">
              <div class="mail">
                <div style="display:grid;grid-template-columns:90px 1fr;gap:6px;font-size:.86rem">
                  <div><strong>Para:</strong></div><div><span class="pill">profe@escuela.edu.mx</span></div>
                  <div><strong>Asunto:</strong></div><div><span class="pill">Duda de tarea</span></div>
                </div>
                <div style="margin-top:10px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;padding:10px">
                  <strong>Mensaje:</strong> Buen d√≠a, profe. ¬øCu√°l es la fecha de entrega? Gracias.
                  <div style="margin-top:8px" class="muted">Firma: Atentamente, (tu nombre)</div>
                </div>

                <div style="margin-top:10px">
                  <div class="muted" style="font-size:.78rem;margin-bottom:6px">Marca las partes correctas:</div>
                  <div class="options-grid">
                    ${a.parts.map(p=>`
                      <label class="option-card">
                        <input type="checkbox" data-emailpart="${a.id}" value="${escapeAttr(p)}">
                        <span>${escapeHtml(p)}</span>
                      </label>
                    `).join("")}
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      if(a.type==="tripleClassify"){
        return `
          <div class="muted" style="font-size:.82rem;margin-bottom:6px">Clasifica tarjetas (selecciona columna).</div>
          ${a.cards.map((c,idx)=>`
            <div style="border:1px solid #e5e7eb;border-radius:12px;padding:8px;margin-bottom:8px;background:#fff">
              <div style="font-weight:800">${idx+1}. ${escapeHtml(c.text)}</div>
              <div class="row" style="margin-top:6px">
                <span class="muted" style="font-size:.78rem">Columna:</span>
                <select data-tclass="${a.id}" data-card="${c.id}">
                  <option value="">‚Äî Elegir ‚Äî</option>
                  ${a.cols.map(col=>`<option value="${col.key}">${escapeHtml(col.label)}</option>`).join("")}
                </select>
              </div>
            </div>
          `).join("")}
          <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:10px">
            ${a.cols.map(col=>`
              <div style="border:1px dashed #fca5a5;border-radius:14px;padding:10px;background:#fff1f2">
                <strong>${escapeHtml(col.label)}</strong>
                <div class="muted" style="font-size:.78rem;margin-top:4px">Aqu√≠ se colocan tarjetas.</div>
              </div>
            `).join("")}
          </div>
        `;
      }

      if(a.type==="dualAddressBuild"){
        return `
          <div class="muted" style="font-size:.82rem;margin-bottom:6px">Clasifica cada elemento: ¬øPostal o Email?</div>
          ${a.dragParts.map((p,idx)=>`
            <div style="border:1px solid #e5e7eb;border-radius:12px;padding:8px;margin-bottom:8px;background:#fff">
              <div style="font-weight:800">${idx+1}. ${escapeHtml(p)}</div>
              <div class="row" style="margin-top:6px">
                <span class="muted" style="font-size:.78rem">Pertenece a:</span>
                <select data-addr="${a.id}" data-part="${escapeAttr(p)}">
                  <option value="">‚Äî Elegir ‚Äî</option>
                  <option value="postal">üì¨ Direcci√≥n postal</option>
                  <option value="email">üìß Direcci√≥n email</option>
                </select>
              </div>
            </div>
          `).join("")}
          <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:10px">
            <div style="border:1px dashed #fca5a5;border-radius:14px;padding:10px;background:#fff1f2">
              <strong>üì¨ Postal</strong>
              <div class="muted" style="font-size:.78rem;margin-top:4px">${escapeHtml(a.postalParts.join(" ¬∑ "))}</div>
            </div>
            <div style="border:1px dashed #fca5a5;border-radius:14px;padding:10px;background:#fff1f2">
              <strong>üìß Email</strong>
              <div class="muted" style="font-size:.78rem;margin-top:4px">${escapeHtml(a.emailParts.join(" ¬∑ "))}</div>
            </div>
          </div>
        `;
      }

      if(a.type==="waDropdownFill"){
        return `
          <div class="wa" style="border-radius:14px;border:1px solid #e5e7eb">
            <div class="bar"><strong>üí¨ Chat</strong><span>üü¢ en l√≠nea</span></div>
            <div class="chat">
              ${a.messages.map((m,idx)=>`
                <div class="bubble them" style="max-width:100%">
                  <div style="font-weight:900;margin-bottom:6px">Mensaje ${idx+1}</div>
                  <div class="muted" style="font-size:.78rem;margin-bottom:6px">${escapeHtml(m.text)}</div>
                  <div class="row" style="gap:6px">
                    ${m.answers.map((_,bi)=>`
                      <select data-wafill="${a.id}" data-msg="${m.id}" data-blank="${bi}">
                        <option value="">‚Äî adverbio ‚Äî</option>
                        ${a.bank.map(w=>`<option value="${escapeAttr(w)}">${escapeHtml(w)}</option>`).join("")}
                      </select>
                    `).join("")}
                  </div>
                </div>
              `).join("")}
            </div>
          </div>
        `;
      }

      if(a.type==="outboxSim"){
        return `
          <div class="gmail" style="border-radius:14px;border:1px solid #e5e7eb;overflow:hidden">
            <div class="bar">
              <strong style="color:#7f1d1d">üì§ Bandeja de salida</strong>
              <span class="muted">Decide el medio correcto</span>
            </div>
            <div class="list">
              ${a.mails.map((m,idx)=>`
                <div class="mail" data-outbox="${a.id}" data-case="${m.id}">
                  <div class="muted" style="font-size:.78rem;margin-bottom:6px">Env√≠o ${idx+1}</div>
                  <div style="display:grid;grid-template-columns:90px 1fr;gap:6px;font-size:.86rem">
                    <div><strong>De:</strong></div><div>${escapeHtml(m.from)}</div>
                    <div><strong>Para:</strong></div><div>${escapeHtml(m.to)}</div>
                    <div><strong>Asunto:</strong></div><div>${escapeHtml(m.subject)}</div>
                  </div>
                  <div class="row" style="margin-top:8px">
                    <span class="muted" style="font-size:.78rem">Enviar como:</span>
                    <label class="option-card"><input type="radio" name="${a.id}_${m.id}" value="postal"><span>üì¨ Postal</span></label>
                    <label class="option-card"><input type="radio" name="${a.id}_${m.id}" value="email"><span>üìß Email</span></label>
                  </div>
                </div>
              `).join("")}
            </div>
          </div>
        `;
      }

      return `<div class="note">UI no definida para tipo: <strong>${escapeHtml(a.type)}</strong></div>`;
    }

    /* =========================
       GO (actualizado)
       ========================= */
    function go(key){
      APP.currentKey = key;
      setActiveNav(key);

      if(key==="info"){
        setHeader("üìò Hoja informativa: formas de comunicaci√≥n", "Exploro");
        $("#kpiPDA").textContent = "Info";
        showScreen("screen-info");
        updateKPIs();
        return;
      }

      if(key==="results"){
        setHeader("üßæ Resultados", "Eval√∫o");
        $("#kpiPDA").textContent = "Resultados";
        showScreen("screen-placeholder");
        $("#screen-placeholder").innerHTML = `
          <div class="pill">Resultados</div>
          <h2 style="margin:10px 0 6px;color:#7f1d1d">üßæ Resultados (se completa en Parte 3)</h2>
          <p class="muted" style="margin:0">En Parte 3 se mostrar√° tabla, insignias e impresi√≥n.</p>
        `;
        updateKPIs();
        return;
      }

      if(key==="diploma"){
        setHeader("üèÖ Diploma", "Logro");
        $("#kpiPDA").textContent = "Diploma";
        showScreen("screen-placeholder");
        $("#screen-placeholder").innerHTML = `
          <div class="pill">Diploma</div>
          <h2 style="margin:10px 0 6px;color:#7f1d1d">üèÖ Diploma (se completa en Parte 3)</h2>
          <p class="muted" style="margin:0">En Parte 3 se generar√° el diploma moderno e impresi√≥n.</p>
        `;
        updateKPIs();
        return;
      }

      const p = gradeData().pda.find(x=>x.key===key);
      if(p){
        setHeader(`üß© ${p.title}: Actividades`, "Practico");
        $("#kpiPDA").textContent = p.title.replace("PDA ","P");
        showScreen(`screen-${p.key}`);
        updateKPIs();
        // Botones check/reset se vuelven reales en Parte 3; aqu√≠ solo est√°n listos.
        return;
      }

      showScreen("screen-info");
      updateKPIs();
    }

    function updateKPIs(){
      const totalActs = gradeData().pda.length * 2;
      const doneActs = Object.keys(APP.scores).length;
      const pct = totalActs ? Math.round((doneActs/totalActs)*100) : 0;
      $("#kpiProg").textContent = pct + "%";
    }
    function updateAttemptPill(){
      const totalActs = gradeData().pda.length * 2;
      const maxTotalAttempts = totalActs * APP.maxAttempts;
      const used = Object.values(APP.attempts).reduce((a,b)=>a+b,0);
      $("#attemptPill").textContent = `Intentos: ${used}/${maxTotalAttempts}`;
    }

    /* =========================
       START GRADE (override Parte 1)
       ========================= */
    function startGrade(g){
      APP.grade = g;
      setChipGrade();
      $("#cover").style.display = "none";
      $("#app").style.display = "block";

      // Limpia pantallas PDA previas si cambias de grado
      $$(".screen").forEach(sc=>{
        if(sc.id.startsWith("screen-pda")) sc.remove();
      });

      buildNav();
      go("info");
    }
    $("#btnStart5").onclick = ()=>startGrade("5");
    $("#btnStart6").onclick = ()=>startGrade("6");

    // Bot√≥n resultados (manda a results)
    $("#btnResults").onclick = ()=>go("results");

    // Ajusta impresi√≥n (Parte 3 reemplaza)
    $("#btnPrintResults").onclick = ()=>alert("La impresi√≥n real se activa en la PARTE 3.");
    $("#btnPrintDiploma").onclick = ()=>alert("La impresi√≥n real se activa en la PARTE 3.");

  </script>
  <!-- =======================
       PARTE 3/3 (FINAL)
       - Evaluaci√≥n real por tipo de actividad
       - 2 intentos por actividad + bloqueo
       - Resultados + insignias
       - Diploma moderno imprimible
       - Impresi√≥n SIN auto-imprimir al abrir
  ======================== -->
  <script>
    /* ==========================================================
       PARTE 3/3 ‚Äì Motor de evaluaci√≥n, intentos, resultados, diploma
       ========================================================== */

    // ---------- Helpers UI ----------
    function setStatus(actId, msg, kind="info"){
      const st = document.getElementById("status_"+actId);
      if(!st) return;
      st.textContent = msg;

      st.style.border = "1px solid #fed7d7";
      st.style.fontWeight = "800";
      st.style.background = "#fff1f2";
      st.style.color = "#7f1d1d";

      if(kind==="ok"){
        st.style.background = "#dcfce7";
        st.style.border = "1px solid #86efac";
        st.style.color = "#166534";
      }
      if(kind==="bad"){
        st.style.background = "#fee2e2";
        st.style.border = "1px solid #fecaca";
        st.style.color = "#991b1b";
      }
      if(kind==="lock"){
        st.style.background = "#111827";
        st.style.border = "1px solid #374151";
        st.style.color = "#e5e7eb";
      }
    }

    function getAttempts(actId){
      return APP.attempts[actId] ?? 0;
    }
    function incAttempt(actId){
      APP.attempts[actId] = getAttempts(actId) + 1;
      updateAttemptPill();
    }

    function findActivityScope(actId){
      const btn = document.querySelector(`button[data-action="check"][data-activity="${CSS.escape(actId)}"]`);
      if(!btn) return null;
      return btn.closest(".card");
    }

    function lockActivity(actId){
      const scope = findActivityScope(actId);
      if(!scope) return;

      scope.querySelectorAll("input,select,button").forEach(el=>{
        if(el.matches('button[data-action="reset"]')) return;
        if(el.matches('button[data-action="check"]')) el.disabled = true;
        if(el.matches("input,select")) el.disabled = true;
      });

      const resetBtn = scope.querySelector('button[data-action="reset"]');
      if(resetBtn){
        resetBtn.disabled = false;
        resetBtn.title = "Puedes limpiar la vista, pero ya no hay intentos para calificar.";
      }

      setStatus(actId, "üîí Sin intentos (2/2)", "lock");
    }

    function updateAttemptPill(){
      const totalActs = gradeData().pda.length * 2;
      const maxTotalAttempts = totalActs * APP.maxAttempts;
      const used = Object.values(APP.attempts).reduce((a,b)=>a+b,0);
      document.getElementById("attemptPill").textContent = `Intentos: ${used}/${maxTotalAttempts}`;
    }

    function updateKPIs(){
      const totalActs = gradeData().pda.length * 2;
      const doneActs = Object.keys(APP.scores).length;
      const pct = totalActs ? Math.round((doneActs/totalActs)*100) : 0;
      document.getElementById("kpiProg").textContent = pct + "%";
    }

    function computeGlobal(){
      const totalActs = gradeData().pda.length * 2;
      const scoredActs = Object.values(APP.scores);
      const totalQ = scoredActs.reduce((s,a)=>s + (a.total||0), 0);
      const totalOK = scoredActs.reduce((s,a)=>s + (a.ok||0), 0);
      const percent = totalQ ? Math.round((totalOK/totalQ)*100) : 0;
      const completion = totalActs ? Math.round((scoredActs.length/totalActs)*100) : 0;
      return { totalActs, scoredCount: scoredActs.length, totalQ, totalOK, percent, completion };
    }

    function awardBadges(summary){
      const badges = [];
      if(summary.completion >= 100) badges.push({emoji:"üèÅ", name:"ODA completada"});
      if(summary.percent >= 90 && summary.completion >= 70) badges.push({emoji:"üåü", name:"Comunicador/a excelente"});
      if(summary.percent >= 75 && summary.completion >= 60) badges.push({emoji:"üì®", name:"Mensajes claros"});
      if(summary.percent >= 60) badges.push({emoji:"üß†", name:"Buen progreso"});
      if(summary.scoredCount >= 4) badges.push({emoji:"üéØ", name:"Constancia"});
      if(badges.length===0) badges.push({emoji:"üí™", name:"Sigue practicando"});
      return badges;
    }

    // ---------- Evaluaci√≥n por actividad ----------
    function gradeActivity(activityId){
      const gd = gradeData();
      for(const p of gd.pda){
        if(p.a1.id===activityId) return {pda:p, act:p.a1};
        if(p.a2.id===activityId) return {pda:p, act:p.a2};
      }
      return null;
    }

    // ===== Tipos de calificaci√≥n =====
    function scoreMCQ(act){
      let ok = 0;
      const total = act.items.length;
      act.items.forEach((it, idx)=>{
        const chosen = document.querySelector(`input[name="${act.id}_q${idx}"]:checked`);
        const val = chosen ? parseInt(chosen.value,10) : -1;
        if(val === it.answer) ok++;
      });
      return {ok,total};
    }

    function scoreOrderSelect(act){
      let ok = 0;
      const total = act.steps.length;
      const picks = document.querySelectorAll(`select[data-order="${act.id}"]`);
      picks.forEach(sel=>{
        const slot = parseInt(sel.dataset.slot,10);
        const expected = act.steps[slot];
        if(sel.value === expected) ok++;
      });
      return {ok,total};
    }

    function scoreDragOrder(act){
      let ok = 0;
      const total = act.steps.length;
      const picks = document.querySelectorAll(`select[data-dorder="${act.id}"]`);
      picks.forEach(sel=>{
        const slot = parseInt(sel.dataset.slot,10);
        const expected = act.steps[slot];
        if(sel.value === expected) ok++;
      });
      return {ok,total};
    }

    function scoreDragClassify(act){
      let ok = 0;
      const total = act.cards.length;
      act.cards.forEach(card=>{
        const sel = document.querySelector(`select[data-pick="${act.id}"][data-card="${card.id}"]`);
        const val = sel ? sel.value : "";
        if(val === card.bin) ok++;
      });
      return {ok,total};
    }

    function scoreDragFill(act){
      let ok = 0;
      const total = act.blanks.length;
      act.blanks.forEach((b, i)=>{
        const sel = document.querySelector(`select[data-fill="${act.id}"][data-blank="${i}"]`);
        const val = sel ? sel.value : "";
        if(val === b.answer) ok++;
      });
      return {ok,total};
    }

    function scoreEmailMini(act){
      let ok = 0;
      const total = act.scenarios.length;
      act.scenarios.forEach(sc=>{
        const chosen = document.querySelector(`input[name="${act.id}_${sc.id}"]:checked`);
        const val = chosen ? chosen.value : "";
        if(val === sc.best) ok++;
      });
      return {ok,total};
    }

    function scoreWaChoose(act){
      let ok = 0;
      const total = act.situations.length;
      act.situations.forEach(s=>{
        const sel = document.querySelector(`select[data-wachoose="${act.id}"][data-sit="${s.id}"]`);
        const val = sel ? sel.value : "";
        if(val === s.correct) ok++;
      });
      return {ok,total};
    }

    function scoreEmailAnatomy(act){
      let ok = 0;
      const total = act.correctParts.length;
      const checks = document.querySelectorAll(`input[type="checkbox"][data-emailpart="${act.id}"]`);
      const picked = Array.from(checks).filter(c=>c.checked).map(c=>c.value);

      act.correctParts.forEach(p=>{
        if(picked.includes(p)) ok++;
      });

      const extras = picked.filter(x=>!act.correctParts.includes(x)).length;
      ok = Math.max(0, ok - extras);
      return {ok,total};
    }

    function scoreTripleClassify(act){
      let ok = 0;
      const total = act.cards.length;
      act.cards.forEach(card=>{
        const sel = document.querySelector(`select[data-tclass="${act.id}"][data-card="${card.id}"]`);
        const val = sel ? sel.value : "";
        if(val === card.col) ok++;
      });
      return {ok,total};
    }

    function scoreDualAddress(act){
      let ok = 0;
      const total = act.dragParts.length;
      act.dragParts.forEach(part=>{
        const sel = document.querySelector(`select[data-addr="${act.id}"][data-part="${CSS.escape(part)}"]`);
        const val = sel ? sel.value : "";
        let expected = "";
        if(act.postalParts.includes(part)) expected = "postal";
        if(act.emailParts.includes(part)) expected = "email";
        if(val === expected) ok++;
      });
      return {ok,total};
    }

    function scoreWaDropdown(act){
      let ok = 0;
      const total = act.messages.reduce((s,m)=>s + m.answers.length, 0);

      act.messages.forEach(m=>{
        m.answers.forEach((ans, bi)=>{
          const sel = document.querySelector(`select[data-wafill="${act.id}"][data-msg="${m.id}"][data-blank="${bi}"]`);
          const val = sel ? sel.value : "";
          if(val === ans) ok++;
        });
      });

      return {ok,total};
    }

    function scoreOutbox(act){
      let ok = 0;
      const total = act.mails.length;
      act.mails.forEach(m=>{
        const chosen = document.querySelector(`input[name="${act.id}_${m.id}"]:checked`);
        const val = chosen ? chosen.value : "";
        if(val === m.best) ok++;
      });
      return {ok,total};
    }

    function evaluateByType(act){
      switch(act.type){
        case "mcq": return scoreMCQ(act);
        case "orderSelect": return scoreOrderSelect(act);
        case "dragOrder": return scoreDragOrder(act);
        case "dragClassify": return scoreDragClassify(act);
        case "dragFill": return scoreDragFill(act);
        case "emailMini": return scoreEmailMini(act);
        case "waChooseChat": return scoreWaChoose(act);
        case "emailAnatomy": return scoreEmailAnatomy(act);
        case "tripleClassify": return scoreTripleClassify(act);
        case "dualAddressBuild": return scoreDualAddress(act);
        case "waDropdownFill": return scoreWaDropdown(act);
        case "outboxSim": return scoreOutbox(act);
        default: return {ok:0,total:0};
      }
    }

    // ---------- Retroalimentaci√≥n ----------
    function feedback(score){
      const pct = score.total ? Math.round((score.ok/score.total)*100) : 0;
      if(pct >= 80) return {msg:`‚úÖ Muy bien: ${score.ok}/${score.total} (${pct}%)`, kind:"ok"};
      if(pct >= 60) return {msg:`üü° Bien: ${score.ok}/${score.total} (${pct}%)`, kind:"info"};
      return {msg:`üî¥ Revisa: ${score.ok}/${score.total} (${pct}%)`, kind:"bad"};
    }

    function saveScore(actId, score){
      const pct = score.total ? Math.round((score.ok/score.total)*100) : 0;
      APP.scores[actId] = { ...score, percent:pct, ts: Date.now() };
      updateKPIs();
    }

    // ---------- Pantallas: Resultados y Diploma ----------
    function renderResultsScreen(){
      const sum = computeGlobal();
      const badges = awardBadges(sum);
      const student = (APP.student || "Sin nombre");
      const gradeLabel = APP.grade==="5" ? "5.¬∫ grado" : "6.¬∫ grado";

      const rows = [];
      gradeData().pda.forEach(p=>{
        const a1 = APP.scores[p.a1.id];
        const a2 = APP.scores[p.a2.id];
        const pct1 = a1 ? `${a1.ok}/${a1.total} (${a1.percent}%)` : "‚Äî";
        const pct2 = a2 ? `${a2.ok}/${a2.total} (${a2.percent}%)` : "‚Äî";
        rows.push(`
          <tr>
            <td style="font-weight:900">${escapeHtml(p.title)}</td>
            <td>${escapeHtml(p.subtitle)}</td>
            <td>${pct1}</td>
            <td>${pct2}</td>
          </tr>
        `);
      });

      return `
        <div class="pill">Eval√∫o</div>
        <h2 style="margin:10px 0 6px;color:#7f1d1d">üßæ Hoja de resultados</h2>

        <div class="note" style="background:#fff;border:1px solid #fee2e2;color:#111827">
          <div style="display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between">
            <div>
              <div style="font-weight:900;font-size:1.05rem;color:#7f1d1d">${escapeHtml(student)}</div>
              <div class="muted">${gradeLabel} ¬∑ ${escapeHtml(CONTENT10.meta.content)}</div>
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end">
              <span class="kpi">Actividades calificadas: <b>${sum.scoredCount}/${sum.totalActs}</b></span>
              <span class="kpi">Aciertos: <b>${sum.totalOK}/${sum.totalQ || "‚Äî"}</b></span>
              <span class="kpi">Promedio: <b>${sum.percent}%</b></span>
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <div style="display:flex;flex-wrap:wrap;gap:8px">
          ${badges.map(b=>`<span class="pill" style="background:#fff;border:1px solid #fee2e2;color:#7f1d1d;font-weight:900">${b.emoji} ${escapeHtml(b.name)}</span>`).join("")}
        </div>

        <div class="hr"></div>

        <div style="overflow:auto;border:1px solid #e5e7eb;border-radius:14px;background:#fff">
          <table style="width:100%;border-collapse:collapse;font-size:.86rem">
            <thead>
              <tr style="background:#fff1f2;color:#7f1d1d">
                <th style="padding:8px;border-bottom:1px solid #fee2e2;text-align:left">PDA</th>
                <th style="padding:8px;border-bottom:1px solid #fee2e2;text-align:left">Descripci√≥n</th>
                <th style="padding:8px;border-bottom:1px solid #fee2e2;text-align:left">Actividad 1</th>
                <th style="padding:8px;border-bottom:1px solid #fee2e2;text-align:left">Actividad 2</th>
              </tr>
            </thead>
            <tbody>
              ${rows.join("")}
            </tbody>
          </table>
        </div>

        <div class="note" style="margin-top:12px">
          üñ®Ô∏è Usa los botones de arriba para imprimir resultados o diploma.
        </div>
      `;
    }

    function renderDiplomaScreen(){
      const sum = computeGlobal();
      const student = (APP.student || "_____________________");
      const gradeLabel = APP.grade==="5" ? "5.¬∫ grado" : "6.¬∫ grado";
      const dateStr = new Date().toLocaleDateString("es-MX", {year:"numeric", month:"long", day:"numeric"});

      const level = sum.percent >= 90 ? "Excelencia" : sum.percent >= 75 ? "Destacado" : sum.percent >= 60 ? "En progreso" : "Participaci√≥n";
      const medal = sum.percent >= 90 ? "ü•á" : sum.percent >= 75 ? "ü•à" : sum.percent >= 60 ? "ü•â" : "üéñÔ∏è";

      return `
        <div class="pill">Logro</div>
        <h2 style="margin:10px 0 6px;color:#7f1d1d">üèÖ Diploma</h2>

        <div style="border:1px solid #e5e7eb;border-radius:18px;overflow:hidden;background:#fff;box-shadow:0 12px 22px rgba(15,23,42,.08)">
          <div style="padding:14px 14px;background:linear-gradient(90deg,#7a0f1f,#b91c1c,#f97316);color:#fff;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
            <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
              <img src="../../img/sep_logo.png" alt="SEP" style="height:40px;background:#fff;padding:4px 8px;border-radius:10px">
              <img src="../../img/escudo_escuela.png" alt="Escuela" style="height:40px;background:#fff;padding:4px 8px;border-radius:10px">
            </div>
            <div style="font-weight:900">ODA Lenguajes ¬∑ Contenido 10</div>
          </div>

          <div style="padding:16px">
            <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:flex-start">
              <div>
                <div style="font-size:1.6rem;font-weight:1000;color:#7f1d1d;letter-spacing:.02em">DIPLOMA DE LOGRO</div>
                <div class="muted">Se otorga a:</div>
                <div style="margin-top:6px;font-size:1.35rem;font-weight:1000;color:#111827">${escapeHtml(student)}</div>
                <div class="muted" style="margin-top:4px">${gradeLabel}</div>
              </div>

              <div style="text-align:right">
                <div style="font-size:2rem">${medal}</div>
                <div class="pill" style="justify-content:center">${escapeHtml(level)}</div>
                <div class="muted" style="margin-top:6px">Promedio actual: <strong style="color:#7f1d1d">${sum.percent}%</strong></div>
                <div class="muted">Actividades calificadas: <strong>${sum.scoredCount}/${sum.totalActs}</strong></div>
              </div>
            </div>

            <div class="hr"></div>

            <div style="font-size:.95rem;color:#111827">
              Por su participaci√≥n y desempe√±o en la ODA:
              <strong style="color:#7f1d1d">‚ÄúDe la carta al WhatsApp: Producci√≥n y env√≠o de cartas personales‚Äù</strong>,
              demostrando habilidades para elegir el medio de comunicaci√≥n adecuado y reconocer estructuras de mensajes.
            </div>

            <div style="margin-top:12px;display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:flex-end">
              <div>
                <div class="muted" style="font-size:.84rem">Lugar y fecha</div>
                <div style="font-weight:900">Ejido Santa Mar√≠a, Pesquer√≠a, N.L.</div>
                <div class="muted">${escapeHtml(dateStr)}</div>
              </div>

              <div style="min-width:260px">
                <div style="height:1px;background:#e5e7eb;margin-bottom:6px"></div>
                <div style="font-weight:900">Mtro. Mart√≠n Reta</div>
                <div class="muted" style="font-size:.84rem">ODA creada por el Maestro Mart√≠n Reta</div>
              </div>
            </div>

            <div class="note" style="margin-top:12px">
              üìå Tip: Para que salga perfecto, escribe tu nombre en la barra izquierda antes de imprimir.
            </div>
          </div>
        </div>
      `;
    }

    function buildResultsAndDiplomaScreens(){
      const host = document.querySelector(".cardBd");
      if(!document.getElementById("screen-results")){
        const s = document.createElement("div");
        s.className = "screen";
        s.id = "screen-results";
        host.appendChild(s);
      }
      if(!document.getElementById("screen-diploma")){
        const s = document.createElement("div");
        s.className = "screen";
        s.id = "screen-diploma";
        host.appendChild(s);
      }
    }

    function refreshResults(){
      buildResultsAndDiplomaScreens();
      document.getElementById("screen-results").innerHTML = renderResultsScreen();
      document.getElementById("screen-diploma").innerHTML = renderDiplomaScreen();
    }

    // ---------- Impresi√≥n ----------
    function printHTML(title, innerHTML){
      const w = window.open("", "_blank");
      if(!w) return alert("Tu navegador bloque√≥ la ventana de impresi√≥n. Permite pop-ups para imprimir.");
      w.document.open();
      w.document.write(`
        <!DOCTYPE html>
        <html lang="es">
        <head>
          <meta charset="UTF-8" />
          <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
          <title>${escapeHtml(title)}</title>
          <style>
            body{font-family:system-ui,-apple-system,"Segoe UI",sans-serif;margin:0;padding:18px;color:#111827}
            .wrap{max-width:900px;margin:0 auto}
            @media print{ body{padding:0} .no-print{display:none !important;} }
            .no-print{
              margin-bottom:12px;padding:10px 12px;border:1px solid #e5e7eb;border-radius:12px;background:#f9fafb;
              color:#374151;display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
            }
            button{
              border:none;border-radius:999px;padding:8px 12px;font-weight:900;cursor:pointer;background:#b91c1c;color:#fff;
            }
            button.secondary{background:#111827}
          </style>
        </head>
        <body>
          <div class="wrap">
            <div class="no-print">
              <div><strong>${escapeHtml(title)}</strong> ¬∑ Vista de impresi√≥n</div>
              <div style="display:flex;gap:8px;flex-wrap:wrap">
                <button onclick="window.print()">üñ®Ô∏è Imprimir</button>
                <button class="secondary" onclick="window.close()">‚úñ Cerrar</button>
              </div>
            </div>
            ${innerHTML}
          </div>
        </body>
        </html>
      `);
      w.document.close();
      // NO auto-print
    }

    // ---------- Override de go() para pantallas reales ----------
    const go_prev = go;
    go = function(key){
      APP.currentKey = key;
      setActiveNav(key);

      if(key==="info"){
        setHeader("üìò Hoja informativa: formas de comunicaci√≥n", "Exploro");
        document.getElementById("kpiPDA").textContent = "Info";
        showScreen("screen-info");
        updateKPIs();
        return;
      }

      if(key==="results"){
        setHeader("üßæ Resultados", "Eval√∫o");
        document.getElementById("kpiPDA").textContent = "Resultados";
        refreshResults();
        showScreen("screen-results");
        updateKPIs();
        return;
      }

      if(key==="diploma"){
        setHeader("üèÖ Diploma", "Logro");
        document.getElementById("kpiPDA").textContent = "Diploma";
        refreshResults();
        showScreen("screen-diploma");
        updateKPIs();
        return;
      }

      const p = gradeData().pda.find(x=>x.key===key);
      if(p){
        setHeader(`üß© ${p.title}: Actividades`, "Practico");
        document.getElementById("kpiPDA").textContent = p.title.replace("PDA ","P");
        showScreen(`screen-${p.key}`);
        updateKPIs();
        return;
      }

      showScreen("screen-info");
      updateKPIs();
    };

    // ---------- Click handler (check/reset) ----------
    document.addEventListener("click", (ev)=>{
      const btn = ev.target.closest("button");
      if(!btn) return;

      if(btn.dataset && btn.dataset.action && btn.dataset.activity){
        const action = btn.dataset.action;
        const actId = btn.dataset.activity;

        const def = gradeActivity(actId);
        if(!def) return;

        if(action==="check"){
          ev.preventDefault();
          updateStudent();
          if(!APP.student){
            alert("Escribe tu nombre en la barra izquierda para guardar correctamente tus resultados.");
          }

          const used = getAttempts(actId);
          if(used >= APP.maxAttempts){
            setStatus(actId, "üîí Sin intentos (2/2)", "lock");
            lockActivity(actId);
            return;
          }

          incAttempt(actId);
          const score = evaluateByType(def.act);
          saveScore(actId, score);

          const fb = feedback(score);
          setStatus(actId, fb.msg + ` ¬∑ Intento ${getAttempts(actId)}/2`, fb.kind);

          if(getAttempts(actId) >= APP.maxAttempts){
            lockActivity(actId);
          }

          if(APP.currentKey==="results" || APP.currentKey==="diploma"){
            refreshResults();
          }
          return;
        }

        if(action==="reset"){
          ev.preventDefault();
          const scope = findActivityScope(actId);
          if(scope){
            scope.querySelectorAll(`input[name^="${actId}"]`).forEach(i=>{
              if(i.type==="radio"||i.type==="checkbox") i.checked=false;
            });
            scope.querySelectorAll(`select`).forEach(s=>{ s.value=""; });
          }
          setStatus(actId, "Listo (respuestas limpiadas)", "info");
          return;
        }
      }
    }, true);

    // ---------- Botones de impresi√≥n reales ----------
    document.getElementById("btnPrintResults").addEventListener("click", ()=>{
      refreshResults();
      const node = document.getElementById("screen-results");
      if(!node) return alert("A√∫n no hay resultados.");
      printHTML("Hoja de resultados ‚Äì ODA Lenguajes (Contenido 10)", node.innerHTML);
    });

    document.getElementById("btnPrintDiploma").addEventListener("click", ()=>{
      refreshResults();
      const node = document.getElementById("screen-diploma");
      if(!node) return alert("A√∫n no hay diploma.");
      printHTML("Diploma ‚Äì ODA Lenguajes (Contenido 10)", node.innerHTML);
    });

    // ---------- Ajustes finales ----------
    updateAttemptPill();
    updateKPIs();

    function enforceLocks(){
      Object.keys(APP.attempts).forEach(actId=>{
        if(getAttempts(actId) >= APP.maxAttempts) lockActivity(actId);
      });
    }
    enforceLocks();

  </script>

</body>
</html>
